@model Education

@{
    ViewData["Title"] = "Eğitim Düzenle";
    Layout = "_AdminLayout";
}

<div class="row">
    <div class="col-md-10 mx-auto">
        <div class="card card-info">
            <div class="card-header">
                <h3 class="card-title">Eğitim Bilgisi Düzenle</h3>
            </div>
            <form method="post" action="/Admin/EditEducation">
                @Html.AntiForgeryToken()
                <input type="hidden" name="Id" value="@Model.Id" />
                <div class="card-body">
                    <div class="form-group">
                        <label>Eğitim Seviyesi</label>
                        <select name="EducationType" class="form-control" id="eduType">
                            <option value="İlköğretim" selected="@(Model.EducationType == "İlköğretim")">İlköğretim</option>
                            <option value="Lise" selected="@(Model.EducationType == "Lise")">Lise</option>
                            <option value="Lisans" selected="@(Model.EducationType == "Lisans")">Lisans</option>
                            <option value="Ön Lisans" selected="@(Model.EducationType == "Ön Lisans")">Ön Lisans</option>
                            <option value="Yüksek Lisans" selected="@(Model.EducationType == "Yüksek Lisans")">Yüksek Lisans</option>
                            <option value="Doktora" selected="@(Model.EducationType == "Doktora")">Doktora</option>
                        </select>
                    </div>

                    <div id="higherEdFields" style="display:none">
                        <div class="row">
                            <div class="col-md-6 form-group">
                                <label>Öğretim Tipi</label>
                                <select name="TeachingType" class="form-control">
                                    <option value="Açık Öğretim" selected="@(Model.TeachingType == "Açık Öğretim")">Açık Öğretim</option>
                                    <option value="İkinci Öğretim" selected="@(Model.TeachingType == "İkinci Öğretim")">İkinci Öğretim</option>
                                    <option value="Örgün Öğretim" selected="@(Model.TeachingType == "Örgün Öğretim")">Örgün Öğretim</option>
                                    <option value="Uzaktan Öğretim" selected="@(Model.TeachingType == "Uzaktan Öğretim")">Uzaktan Öğretim</option>
                                </select>
                            </div>
                            <div class="col-md-6 form-group">
                                <label>Üniversite</label>
                                <input type="text" name="School" value="@Model.School" class="form-control" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 form-group">
                                <label>Fakülte</label>
                                <input type="text" name="Faculty" value="@Model.Faculty" class="form-control" />
                            </div>
                            <div class="col-md-6 form-group">
                                <label>Bölüm</label>
                                <input type="text" name="Department" value="@Model.Department" class="form-control" />
                            </div>
                        </div>
                    </div>

                    <div id="liseFields" style="display:none">
                        <div class="row">
                            <div class="col-md-6 form-group">
                                <label>Lise Adı</label>
                                <input type="text" name="School" value="@Model.School" class="form-control" />
                            </div>
                            <div class="col-md-6 form-group">
                                <label>Bölüm</label>
                                <input type="text" name="Department" value="@Model.Department" class="form-control" />
                            </div>
                        </div>
                    </div>

                    <div id="primaryFields" style="display:none">
                         <div class="form-group">
                            <label>Okul Adı</label>
                            <input type="text" name="School" value="@Model.School" class="form-control" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 form-group">
                            <label>Başlangıç Tarihi</label>
                            <input type="date" name="StartDate" value="@(Model.StartDate.ToString("yyyy-MM-dd"))" class="form-control" required />
                        </div>
                        <div class="col-md-6 form-group" id="endDateGroup">
                            <label>Bitiş Tarihi</label>
                            <input type="date" name="EndDate" value="@(Model.EndDate?.ToString("yyyy-MM-dd"))" class="form-control" />
                        </div>
                    </div>

                    <div class="form-group">
                         <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="isContinuing" name="IsContinuing" value="true" @(Model.IsContinuing ? "checked" : "")>
                            <label class="custom-control-label" for="isContinuing">Halen Devam Ediyor</label>
                        </div>
                    </div>

                    <div id="gradeFields">
                        <div class="row">
                            <div class="col-md-6 form-group">
                                <label>Diploma Not Sistemi</label>
                                <select name="GradeSystem" class="form-control">
                                    <option value="4" selected="@(Model.GradeSystem == "4")">4'lük</option>
                                    <option value="5" selected="@(Model.GradeSystem == "5")">5'lik</option>
                                    <option value="10" selected="@(Model.GradeSystem == "10")">10'luk</option>
                                    <option value="100" selected="@(Model.GradeSystem == "100")">100'lük</option>
                                </select>
                            </div>
                            <div class="col-md-6 form-group">
                                <label>Diploma Notu</label>
                                <input type="text" name="Grade" value="@Model.Grade?.ToString("0.00", System.Globalization.CultureInfo.InvariantCulture).Replace(".", ",")" class="form-control grade-input" placeholder="Örn: 2,91" pattern="[0-9]+([,][0-9]{1,2})?" />
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Sıra</label>
                        <input type="number" name="Order" value="@Model.Order" class="form-control" />
                    </div>

                </div>
                <div class="card-footer text-right">
                    <button type="submit" class="btn btn-info">Güncelle</button>
                    <a href="/Admin/Educations" class="btn btn-default">İptal</a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function toggleFields() {
            let val = $('#eduType').val();
            $('#higherEdFields, #liseFields, #primaryFields').hide();
            
            if (['Lisans', 'Ön Lisans', 'Yüksek Lisans', 'Doktora'].includes(val)) {
                $('#higherEdFields').show();
            } else if (val === 'Lise') {
                $('#liseFields').show();
            } else {
                $('#primaryFields').show();
            }
        }

        $('#eduType').change(toggleFields);
        toggleFields();

        $('#isContinuing').change(function() {
            if (this.checked) {
                $('#endDateGroup, #gradeFields').hide();
            } else {
                $('#endDateGroup, #gradeFields').show();
            }
        });
        
        if ($('#isContinuing').is(':checked')) {
            $('#endDateGroup, #gradeFields').hide();
        }

        // Convert Turkish comma to dot for Grade field before form submission
        $('form').on('submit', function() {
            var gradeInput = $('.grade-input');
            if (gradeInput.length && gradeInput.val()) {
                gradeInput.val(gradeInput.val().replace(',', '.'));
            }
        });
    </script>
}
